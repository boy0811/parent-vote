{% extends "layout.html" %}
{% block title %}å®¶é•·ç°½åˆ°ç¸½è¡¨{% endblock %}

{% block content %}
<div class="container mt-4">

  <h2 class="text-center mb-4">ğŸ“‹ å®¶é•·ç°½åˆ°ç¸½è¡¨</h2>

  {% if current_phase %}
    <div class="alert alert-info text-center fs-5">
      ğŸ“Œ ç•¶å‰éšæ®µï¼š<strong>{{ current_phase.name }}</strong>
    </div>
  {% else %}
    <div class="alert alert-warning text-center fs-5">
      â›” å°šæœªé–‹å•Ÿä»»ä½•éšæ®µ
    </div>
  {% endif %}

  <form method="get" class="d-flex flex-wrap justify-content-center gap-3 mb-4">
    <div class="input-group" style="max-width: 250px;">
      <label class="input-group-text">å¹´ç´š</label>
      <select name="grade" class="form-select">
        <option value="">å…¨éƒ¨</option>
        <option value="å¹¼å…’åœ’" {% if selected_grade == 'å¹¼å…’åœ’' %}selected{% endif %}>å¹¼å…’åœ’</option>
        <option value="ä¸€å¹´ç´š" {% if selected_grade == 'ä¸€å¹´ç´š' %}selected{% endif %}>ä¸€å¹´ç´š</option>
        <option value="äºŒå¹´ç´š" {% if selected_grade == 'äºŒå¹´ç´š' %}selected{% endif %}>äºŒå¹´ç´š</option>
        <option value="ä¸‰å¹´ç´š" {% if selected_grade == 'ä¸‰å¹´ç´š' %}selected{% endif %}>ä¸‰å¹´ç´š</option>
        <option value="å››å¹´ç´š" {% if selected_grade == 'å››å¹´ç´š' %}selected{% endif %}>å››å¹´ç´š</option>
        <option value="äº”å¹´ç´š" {% if selected_grade == 'äº”å¹´ç´š' %}selected{% endif %}>äº”å¹´ç´š</option>
        <option value="å…­å¹´ç´š" {% if selected_grade == 'å…­å¹´ç´š' %}selected{% endif %}>å…­å¹´ç´š</option>
      </select>
      <button type="submit" class="btn btn-primary">æŸ¥è©¢</button>
    </div>
  </form>

  <div class="text-center mb-3 fs-5">
    <strong>å·²ç°½åˆ°ï¼š</strong> <span class="text-success">{{ signed_in_count }}</span> / <span class="text-primary">{{ total_count }}</span>
  </div>

  {% if candidates %}
    <form method="post" action="{{ url_for('admin_checkin.checkin_batch') }}">
      <div class="table-responsive">
        <table class="table table-bordered align-middle text-center">
          <thead class="table-light">
            <tr>
              <th scope="col"><input type="checkbox" id="checkAll"></th>
              <th scope="col">ç­ç´š</th>
              <th scope="col">å®¶é•·å§“å</th>
              <th scope="col">å¸³è™Ÿ</th>
              <th scope="col">ç°½åˆ°ç‹€æ…‹</th>
              <th scope="col">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            {% for c in candidates %}
              <tr>
                <td>
                  {% if not c.is_signed_in %}
                    <input type="checkbox" name="candidate_ids" value="{{ c.id }}">
                  {% endif %}
                </td>
                <td>{{ c.class_name }}</td>
                <td>{{ c.parent_name }}</td>
                <td>{{ c.username }}</td>
                <td>
                  {% if c.is_signed_in %}
                    <span class="badge bg-success">å·²ç°½åˆ°</span>
                  {% else %}
                    <span class="badge bg-secondary">æœªç°½åˆ°</span>
                  {% endif %}
                </td>
                <td>
                  {% if not c.is_signed_in %}
                    <a href="{{ url_for('admin_checkin.checkin', candidate_id=c.id) }}" class="btn btn-sm btn-outline-success">ç°½åˆ°</a>
                  {% else %}
                    <a href="{{ url_for('admin_checkin.uncheckin', candidate_id=c.id) }}" class="btn btn-sm btn-outline-danger">å–æ¶ˆ</a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="text-center mt-3">
        <button type="submit" class="btn btn-primary rounded-pill px-4">æ‰¹æ¬¡ç°½åˆ°</button>
      </div>
    </form>
  {% else %}
    <div class="text-center text-muted fs-5">
      <i class="bi bi-exclamation-circle"></i> æŸ¥ç„¡è³‡æ–™
    </div>
  {% endif %}

  <div class="text-center mt-4">
    <a href="{{ url_for('admin_dashboard.admin_dashboard') }}" class="btn btn-outline-secondary rounded-pill px-4">â† è¿”å›ä¸»æ§å°</a>
  </div>

</div>

<script>
  document.getElementById('checkAll')?.addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('input[name="candidate_ids"]');
    checkboxes.forEach(cb => cb.checked = this.checked);
  });
</script>

{% endblock %}
