{% extends "layout.html" %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center">📋 家長簽到面板</h2>

  <div class="alert alert-info text-center">
    📌 當前階段：
    {% if current_phase %}
      <strong>{{ current_phase.name }}</strong>
    {% else %}
      尚未開啟
    {% endif %}
  </div>

  <div class="alert alert-success text-center">
    ✅ 已簽到 {{ signed_count }} / 總人數 {{ total }}
  </div>

  <table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>帳號</th>
        <th>狀態</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr id="row-{{ u.id }}">
        <td>{{ u.username }}</td>
        <td>
          {% if u.is_signed_in %}
            <span class="badge bg-success">已簽到</span>
            <small class="text-muted">{{ u.signed_in_time.strftime('%Y-%m-%d %H:%M:%S') if u.signed_in_time else '' }}</small>
          {% else %}
            <span class="badge bg-secondary">未簽到</span>
          {% endif %}
        </td>
        <td>
          {% if not u.is_signed_in %}
            <button class="btn btn-sm btn-primary" onclick="signin({{ u.id }})">簽到</button>
          {% else %}
            <button class="btn btn-sm btn-danger" onclick="uncheckin({{ u.id }})">取消簽到</button>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="text-center mt-3">
    <a href="{{ url_for('admin_dashboard.admin_dashboard') }}" class="btn btn-secondary">← 返回主控台</a>
  </div>
</div>

<script>
function signin(userId) {
  fetch(`/checkin_panel/signin/${userId}`, { method: 'POST' })
    .then(r => r.json())
    .then(data => location.reload());
}

function uncheckin(userId) {
  fetch(`/checkin_panel/uncheckin/${userId}`, { method: 'POST' })
    .then(r => r.json())
    .then(data => location.reload());
}
</script>
{% endblock %}
