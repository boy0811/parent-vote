{% extends "layout.html" %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center">ğŸ“‹ å®¶é•·ç°½åˆ°é¢æ¿</h2>

  <div class="alert alert-info text-center">
    ğŸ“Œ ç•¶å‰éšæ®µï¼š
    {% if current_phase %}
      <strong>{{ current_phase.name }}</strong>
    {% else %}
      å°šæœªé–‹å•Ÿ
    {% endif %}
  </div>

  <div class="alert alert-success text-center">
    âœ… å·²ç°½åˆ° {{ signed_count }} / ç¸½äººæ•¸ {{ total }}
  </div>

  <table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>å¸³è™Ÿ</th>
        <th>ç‹€æ…‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr id="row-{{ u.id }}">
        <td>{{ u.username }}</td>
        <td>
          {% if u.is_signed_in %}
            <span class="badge bg-success">å·²ç°½åˆ°</span>
            <small class="text-muted">{{ u.signed_in_time.strftime('%Y-%m-%d %H:%M:%S') if u.signed_in_time else '' }}</small>
          {% else %}
            <span class="badge bg-secondary">æœªç°½åˆ°</span>
          {% endif %}
        </td>
        <td>
          {% if not u.is_signed_in %}
            <button class="btn btn-sm btn-primary" onclick="signin({{ u.id }})">ç°½åˆ°</button>
          {% else %}
            <button class="btn btn-sm btn-danger" onclick="uncheckin({{ u.id }})">å–æ¶ˆç°½åˆ°</button>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="text-center mt-3">
    <a href="{{ url_for('admin_dashboard.admin_dashboard') }}" class="btn btn-secondary">â† è¿”å›ä¸»æ§å°</a>
  </div>
</div>

<script>
function signin(userId) {
  fetch(`/checkin_panel/signin/${userId}`, { method: 'POST' })
    .then(r => r.json())
    .then(data => location.reload());
}

function uncheckin(userId) {
  fetch(`/checkin_panel/uncheckin/${userId}`, { method: 'POST' })
    .then(r => r.json())
    .then(data => location.reload());
}
</script>
{% endblock %}
