{% extends "layout.html" %}
{% block title %}ç³»çµ±è¨­å®š{% endblock %}

{% block content %}
<div class="container mt-5">

  <h2 class="mb-5 text-center"><i class="bi bi-gear"></i> ç³»çµ±è¨­å®š</h2>

  <form method="POST" action="{{ url_for('admin_settings.admin_settings') }}">
    <div class="row g-4">

      <!-- å·¦å´ï¼šæŠ•ç¥¨é æ¨™é¡Œ & è‡ªå‹•åˆ·æ–°ç§’æ•¸ -->
      <div class="col-md-6">
        <div class="card shadow rounded-4 p-4 h-100 border-0" style="background-color: #e9f2fb;">
          <h5 class="mb-4"><i class="bi bi-card-text"></i> æŠ•ç¥¨é æ¨™é¡Œ & è‡ªå‹•åˆ·æ–°ç§’æ•¸</h5>

          <div class="mb-3">
            <label class="form-label">å®¶é•·æŠ•ç¥¨å®Œæˆé æ¨™é¡Œï¼ˆvote_success.htmlï¼‰</label>
            <textarea name="parent_vote_title" class="form-control rounded-3" rows="2">{{ parent_vote_title }}</textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">å‰å°æŠ•ç¥¨é ä¸»æ¨™é¡Œï¼ˆvote.html é¡¯ç¤ºï¼‰</label>
            <textarea name="vote_title" class="form-control rounded-3" rows="2">{{ vote_title }}</textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">æŠ•ç¥¨é è‡ªå‹•åˆ·æ–°ç§’æ•¸</label>
            <input type="number" name="refresh_interval" value="{{ refresh_value }}" class="form-control rounded-3" min="0">
          </div>
      
          <div class="mb-3">
            <label class="form-label">è¼ªæ’­é–“éš”ç§’æ•¸ï¼ˆslide_intervalï¼‰</label>
            <input type="number" class="form-control rounded-3" name="slide_interval" value="{{ slide_interval or 5 }}" min="1">
          </div>
        </div>
      </div>

      <!-- å³å´ï¼šå„éšæ®µæœ€å¤§æŠ•ç¥¨æ•¸ & æ™‰ç´šäººæ•¸ -->
      <div class="col-md-6">
        <div class="card shadow rounded-4 p-4 border-0 h-100" style="background-color: #eaf7ea;">
          <h5 class="mb-4"><i class="bi bi-bullseye"></i> å„éšæ®µæœ€å¤§æŠ•ç¥¨æ•¸ & æ™‰ç´šäººæ•¸</h5>

          <table class="table table-bordered text-center align-middle bg-white rounded-3">
            <thead class="table-light">
              <tr>
                <th>éšæ®µåç¨±</th>
                <th>æ¯äººå¯æŠ•ç¥¨æ•¸</th>
                <th>æ™‰ç´šäººæ•¸</th>
              </tr>
            </thead>
            <tbody>
              {% for phase in phases %}
              <tr>
                <td>{{ phase.name }}</td>
                <td>
                  <input type="number" name="max_votes_{{ phase.id }}" class="form-control text-center rounded-3" value="{{ phase.max_votes }}" min="1">
                </td>
                <td>
                  <input type="number" name="promote_count_{{ phase.id }}" class="form-control text-center rounded-3" value="{{ phase.promote_count }}" min="1">
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </div>

    <!-- ä¸­å±¤ï¼šå„²å­˜æŒ‰éˆ• -->
    <div class="text-center my-5">
      <button type="submit" class="btn btn-success rounded-pill px-5 py-2 shadow">
        ğŸ’¾ å„²å­˜æ‰€æœ‰è¨­å®š
      </button>
    </div>
  </form>

  <!-- ä¸‹å±¤ä¸‰å¡ç‰‡ -->
  <div class="row g-4 mt-3">

    <!-- å·¦ï¼šç«‹å³å‚™ä»½è³‡æ–™åº« -->
    <div class="col-md-4">
      <div class="card shadow rounded-4 p-4 border-0 h-100 text-center" style="background-color: #f0f8ff;">
        <h5 class="mb-4 text-primary"><i class="bi bi-hdd-stack"></i> ç«‹å³å‚™ä»½è³‡æ–™åº«</h5>
        <form method="POST" action="{{ url_for('admin_settings.backup_db') }}">
          <button type="submit" class="btn btn-primary w-100 rounded-pill shadow"
                  onclick="return confirm('ğŸ“¦ ç¢ºå®šè¦ç«‹å³å‚™ä»½ç›®å‰è³‡æ–™åº«å—ï¼Ÿå°‡å„²å­˜è‡³ backup è³‡æ–™å¤¾')">
            ğŸ“¦ å‚™ä»½è³‡æ–™åº«
          </button>
        </form>
      </div>
    </div>

    <!-- ä¸­ï¼šæŠ•ç¥¨æ˜ç´° -->
    <div class="col-md-4">
      <div class="card shadow rounded-4 p-4 border-0 h-100 text-center" style="background-color: #f8f9fa;">
        <h5 class="mb-4"><i class="bi bi-journal-text"></i> æŠ•ç¥¨æ˜ç´°ï¼ˆèª°æŠ•çµ¦èª°ï¼‰</h5>
        <a href="{{ url_for('admin_votes.votes_log') }}" class="btn btn-outline-primary w-100 rounded-pill shadow">
          ğŸ“œ æŸ¥çœ‹èª°æŠ•çµ¦èª°
        </a>
      </div>
    </div>

    <!-- å³ï¼šä¸€éµæ¸…é™¤ -->
    <div class="col-md-4">
      <div class="card shadow rounded-4 p-4 border-0 h-100 text-center" style="background-color: #fff0f0;">
        <h5 class="mb-4 text-danger"><i class="bi bi-x-circle"></i> ä¸€éµæ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼ˆâš ï¸ ç„¡æ³•å¾©åŸï¼‰</h5>
        <form id="clearAllForm" method="POST" action="{{ url_for('admin_settings.clear_all_data') }}">
          <div class="mb-3">
            <input type="text" id="confirm_delete" name="confirm_delete" class="form-control text-center rounded-3" placeholder="è¼¸å…¥ DELETE ä»¥ç¢ºèª">
          </div>
          <button type="submit" class="btn btn-danger w-100 rounded-pill shadow">
            ğŸ§¨ ä¸€éµæ¸…ç©ºæ‰€æœ‰éšæ®µè³‡æ–™
          </button>
        </form>
      </div>
    </div>

  </div>

  <!-- è¿”å›ä¸»æ§å° -->
  <div class="text-center mt-5">
    <a href="{{ url_for('admin_dashboard.admin_dashboard') }}" class="btn btn-outline-secondary rounded-pill px-4">
      â¬…ï¸ è¿”å›ä¸»æ§å°
    </a>
  </div>

</div>

<script>
document.getElementById('clearAllForm').addEventListener('submit', function(e) {
  const input = document.getElementById('confirm_delete').value.trim();
  if (input !== 'DELETE') {
    e.preventDefault();
    alert('âš ï¸ è«‹æ­£ç¢ºè¼¸å…¥ DELETE ä»¥ç¢ºèªæ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼');
  } else {
    return confirm('âš ï¸ çœŸçš„è¦æ¸…é™¤æ‰€æœ‰å€™é¸äººèˆ‡æŠ•ç¥¨ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼');
  }
});
</script>
{% endblock %}
