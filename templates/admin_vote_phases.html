{% extends "layout.html" %}
{% block title %}æŠ•ç¥¨éšæ®µç®¡ç†{% endblock %}

{% block content %}
<div class="container mt-5">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="text-center mb-4">
    <h2>ğŸ› ï¸ æŠ•ç¥¨éšæ®µç®¡ç†</h2>
  </div>

  <!-- è¿”å›ä¸»æ§å° -->
  <div class="mb-3 d-flex flex-wrap gap-2">
    <a href="{{ url_for('admin_dashboard.admin_dashboard') }}" class="btn btn-outline-secondary">â¬…ï¸ è¿”å›ä¸»æ§å°</a>

    <!-- å…¨éƒ¨é—œé–‰æŒ‰éˆ• -->
    <form action="{{ url_for('admin_votes.close_all_phases') }}" method="post">
      <button type="submit" class="btn btn-outline-danger"
              onclick="return confirm('ç¢ºå®šè¦é—œé–‰æ‰€æœ‰éšæ®µï¼Ÿ')">ğŸš« å…¨éƒ¨é—œé–‰</button>
    </form>

    <!-- ä¸€éµé‡è¨­éšæ®µ -->
    <form action="{{ url_for('admin_votes.reset_vote_phases') }}" method="post">
      <button type="submit" class="btn btn-outline-warning"
              onclick="return confirm('âš ï¸ å°‡åˆªé™¤æ‰€æœ‰éšæ®µä¸¦é‡å»ºé è¨­ä¸‰éšæ®µï¼Œç¢ºå®šåŸ·è¡Œï¼Ÿ')">ğŸ§¹ ä¸€éµé‡è¨­éšæ®µ</button>
    </form>
  </div>

  <!-- éšæ®µåˆ—è¡¨ -->
  <table class="table table-bordered text-center">
    <thead class="table-light">
      <tr>
        <th>éšæ®µåç¨±</th>
        <th>æ¯äººå¯æŠ•ç¥¨æ•¸</th>
        <th>æ™‰ç´šäººæ•¸</th>
        <th>æ˜¯å¦é–‹å•Ÿ</th>
        <th>éšæ®µé–‹é—œ</th>
      </tr>
    </thead>
    <tbody>
      {% for phase in phases %}
      <tr>
        <td>{{ phase.name }}</td>
        <td>{{ phase.max_votes }}</td>
        <td>{{ phase.promote_count }}</td>
        <td>
          {% if phase.is_open %}
            <span class="badge bg-success">é–‹å•Ÿä¸­</span>
          {% else %}
            <span class="badge bg-secondary">å·²é—œé–‰</span>
          {% endif %}
        </td>
        <td>
          {% if phase.is_open %}
          <!-- é—œé–‰éšæ®µ -->
          <form action="{{ url_for('admin_votes.close_phase') }}" method="post" style="display:inline;">
            <input type="hidden" name="phase_id" value="{{ phase.id }}">
            <button type="submit" class="btn btn-danger btn-sm"
                    onclick="return confirm('ç¢ºå®šè¦é—œé–‰ã€Œ{{ phase.name }}ã€éšæ®µï¼Ÿ')">é—œé–‰</button>
          </form>
          {% else %}
          <!-- é–‹å•Ÿéšæ®µ -->
          <form action="{{ url_for('admin_votes.open_phase', phase_id=phase.id) }}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-success btn-sm"
                    onclick="return confirm('ç¢ºå®šè¦é–‹å•Ÿã€Œ{{ phase.name }}ã€éšæ®µï¼Ÿå…¶ä»–éšæ®µå°‡æœƒè‡ªå‹•é—œé–‰')">é–‹å•Ÿ</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</div>
{% endblock %}
